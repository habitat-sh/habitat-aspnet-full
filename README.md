# Habitat ASP.NET Full Framework sample application

This is a sample ASP.NET MVC Full Framework IIS based application with accompanying Habitat plan, hooks, and configuration (see the habitat directory). The application itself is the exact same application generated by File/New/Project and choosing the C# ASP.NET MVC application inside of [Visual Studio 2015 Community Edition](https://www.visualstudio.com/).

**UPDATE:** As of Habitat 0.74.0, there is now an `install` hook that allows packages to execute a script upon installation. This means we can now provide packages for .Net full framework runtimes and IIS features. This plan has added these dependencies. In order for the `install` hook to be recognized, the `HAB_FEAT_INSTALL_HOOK` environment variable must be set to any value.

### Our run hook will sleep
Typically having a Hook sleep is an anti-pattern but in the case of an IIS app it makes sense. Our run hooks will simply make sure that our IIS application pool and web sites are present and running. Then it will sleep until the application becomes unresponsive or the service is stopped.

## Building the plan
The Habitat plan includes build time dependencies on `core/nuget` and `core/visual-build-tools-2017` which puts `Nuget.exe` and `MSBuild.exe` on the path and allows the build to find dependencies and compile the application binaries.

## Running the web site
Loading the built service into the Habitat Supervisor will configure IIS to run the application on the configured port. Note that this applicationi includes runtime dependencies on several plans that include `install` hooks which will ensure that the .Net runtime is installed, and the IIS and ASP.NET Windows features are enabled.

The application's `run` hook will use DSC to configure the IIS application pool, site and app.

## Load balancing multiple application instances
This repository includes a `nginx-proxy` plan that can be built and used to load balance several application instances running on separate Supervisors. One way to do this is to export both the `hab-sln` web application and the `nginx-proxy` plans to a Docker image and run miltiple `hab-sln` containers and then bind a `nginx-proxy` container to those web app containers:

```
